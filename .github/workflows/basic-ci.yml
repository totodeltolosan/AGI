name: ‚úÖ Basic CI

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  basic-checks:
    name: Basic Health Checks
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        
    - name: Basic project health
      run: |
        echo "üîç BASIC PROJECT HEALTH CHECK"
        echo "============================="
        
        # Compter fichiers
        python_files=$(find . -name "*.py" -not -path "./.git/*" | wc -l)
        echo "üìä Fichiers Python: $python_files"
        
        # V√©rifier structure
        if [ -d "core" ]; then echo "‚úÖ Dossier core: pr√©sent"; else echo "‚ùå Dossier core: manquant"; fi
        if [ -d "eve" ]; then echo "‚úÖ Dossier eve: pr√©sent"; else echo "‚ùå Dossier eve: manquant"; fi
        
    - name: Python syntax validation
      run: |
        echo "üêç VALIDATION SYNTAXE PYTHON"
        echo "============================"
        
        syntax_errors=0
        for file in $(find . -name "*.py" -not -path "./.git/*"); do
          if ! python -m py_compile "$file" 2>/dev/null; then
            echo "‚ùå Erreur syntaxe: $file"
            syntax_errors=$((syntax_errors + 1))
          fi
        done
        
        if [ $syntax_errors -eq 0 ]; then
          echo "‚úÖ Tous les fichiers Python ont une syntaxe valide"
        else
          echo "‚ùå $syntax_errors fichiers avec erreurs syntaxe"
          exit 1
        fi
        
    - name: Constitutional compliance check
      run: |
        echo "üèõÔ∏è V√âRIFICATION CONFORMIT√â CONSTITUTIONNELLE"
        echo "=========================================="
        
        violations=$(find . -name "*.py" -not -path "./.git/*" -exec wc -l {} \; | awk '$1 > 200 {print $2 " (" $1 " lignes)"}')
        
        if [ ! -z "$violations" ]; then
          echo "‚ùå Violations limite 200 lignes:"
          echo "$violations"
          exit 1
        else
          echo "‚úÖ Conformit√© constitutionnelle respect√©e"
        fi
        
    - name: Basic functionality test
      run: |
        echo "‚öôÔ∏è TEST FONCTIONNALIT√â BASIQUE"
        echo "============================="
        
        python3 -c "
        import sys
        import os
        print('‚úÖ Python fonctionnel')
        print(f'Version: {sys.version}')
        print(f'Path: {sys.path[0]}')
        
        # Test imports courants
        try:
            import json, pathlib, subprocess
            print('‚úÖ Modules standards disponibles')
        except ImportError as e:
            print(f'‚ùå Erreur import: {e}')
            sys.exit(1)
        "
        
        echo "‚úÖ Basic CI termin√© avec succ√®s"
