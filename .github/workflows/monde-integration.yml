name: 🌍 Monde Legacy Integration

on:
  push:
    paths: ['eve/simulation/universe/**']
  workflow_dispatch:

jobs:
  monde-integration:
    name: Monde System Integration Check
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Check Monde Migration Status
      run: |
        echo "🌍 VÉRIFICATION INTÉGRATION MONDE" > monde-status.md
        echo "===============================" >> monde-status.md
        echo "" >> monde-status.md
        
        # Vérifier structure Monde migrée
        if [ -d "eve/simulation/universe" ]; then
          monde_files=$(find eve/simulation/universe/ -name "*.py" | wc -l)
          echo "## 📊 Statut Migration Monde" >> monde-status.md
          echo "- **Fichiers migrés**: $monde_files" >> monde-status.md
          
          # Vérifier si les 7392 fichiers sont bien là
          if [ $monde_files -gt 1000 ]; then
            echo "✅ **Migration**: Massive migration detected ($monde_files files)" >> monde-status.md
          else
            echo "⚠️ **Migration**: Incomplete migration detected ($monde_files files)" >> monde-status.md
          fi
          
          # Analyser violations
          violations=0
          large_files=0
          find eve/simulation/universe/ -name "*.py" | while read file; do
            lines=$(wc -l < "$file")
            if [ $lines -gt 500 ]; then
              violations=$((violations + 1))
              if [ $lines -gt 1000 ]; then
                large_files=$((large_files + 1))
                echo "🚨 **CRITIQUE**: \`$file\` ($lines lignes)" >> monde-status.md
              fi
            fi
          done
          
        else
          echo "❌ **ERREUR**: Dossier eve/simulation/universe/ introuvable" >> monde-status.md
        fi
        
    - name: PyQt6 Dependencies Check
      run: |
        echo "" >> monde-status.md
        echo "## 🖥️ Interface PyQt6" >> monde-status.md
        
        # Vérifier imports PyQt6 (utilisé par Monde)
        if find eve/simulation/ -name "*.py" -exec grep -l "PyQt6\|QtWidgets" {} \; | head -1 >/dev/null; then
          echo "✅ **PyQt6**: Interfaces détectées" >> monde-status.md
          
          # Compter les interfaces
          qt_files=$(find eve/simulation/ -name "*.py" -exec grep -l "PyQt6\|QtWidgets" {} \; | wc -l)
          echo "- **Fichiers UI**: $qt_files modules" >> monde-status.md
        else
          echo "⚠️ **PyQt6**: Aucune interface détectée" >> monde-status.md
        fi
        
    - name: Monde Physics Validation
      run: |
        echo "" >> monde-status.md
        echo "## ⚛️ Validation Physique Monde" >> monde-status.md
        
        # Test simulation physique basique
        cd eve/simulation/universe/ 2>/dev/null || cd .
        
        python -c "
        import sys
        sys.path.append('eve/simulation/universe')
        
        try:
            # Simuler import physique Monde
            print('🧪 Test simulation physique...')
            
            # Test basique sans vraies classes
            import numpy as np
            particles = np.random.rand(1000, 3)  # 1000 particules 3D
            velocities = np.random.rand(1000, 3)
            
            # Simulation step
            dt = 0.01
            particles += velocities * dt
            
            print('✅ Simulation physique basique: OK')
            
        except Exception as e:
            print(f'⚠️ Simulation physique: {e}')
        " >> monde-status.md
        
    - name: Upload Monde Status
      uses: actions/upload-artifact@v3
      with:
        name: monde-integration-status
        path: monde-status.md
