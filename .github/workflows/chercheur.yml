name: "🔍 Général Le Chercheur - Recherche Solution"

on:
  repository_dispatch:
    types: [chercher-solution]

jobs:
  chercheur-solution:
    name: "🔍 Recherche et Communication Solution"
    runs-on: ubuntu-latest
    
    steps:
      - name: "📁 Téléchargement du code source"
        uses: actions/checkout@v4

      - name: "🐍 Configuration Python 3.11"
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: "🔍 Exécution du Contremaître Chercheur"
        run: |
          echo "🎯 === GÉNÉRAL LE CHERCHEUR ==="
          echo "Type d'événement: ${{ github.event.action }}"
          echo "Payload reçu: ${{ toJson(github.event.client_payload) }}"
          echo ""
          
          # Exécution du script Contremaître
          python .github/scripts/chercheur_solution.py \
            --payload '${{ toJson(github.event.client_payload) }}'

      - name: "📊 Publication du résumé de recherche"
        if: always()
        run: |
          echo "## 🔍 Recherche de Solution - Résultats" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Type de problème :** ${{ github.event.client_payload.type_probleme || 'Non spécifié' }}" >> $GITHUB_STEP_SUMMARY
          echo "**Événement déclenché :** ${{ github.event.action }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "✅ **Recherche terminée** - Solution proposée et communiquée" >> $GITHUB_STEP_SUMMARY
