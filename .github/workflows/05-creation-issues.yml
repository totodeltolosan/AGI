name: "‚öñÔ∏è G√©n√©ral Le Greffier - Cr√©ation Issues"

on:
  workflow_call:
    inputs:
      noms_artefacts:
        description: "Noms des artefacts de rapports"
        required: true
        type: string
      audit_id:
        description: 'ID unique de cet audit'
        required: true
        type: string
      urgency_level:
        description: 'Niveau d''urgence'
        required: false
        default: 'medium'
        type: string
      constitution_hash:
        description: 'Hash de la constitution'
        required: true
        type: string
      orchestrator_version:
        description: 'Version de l''orchestrateur'
        required: true
        type: string
      skip_generals:
        description: 'G√©n√©raux √† ignorer'
        required: false
        default: ''
        type: string
      general_name:
        description: 'Nom du g√©n√©ral'
        required: true
        type: string
      law_key:
        description: 'Cl√© de la loi'
        required: true
        type: string
    outputs:
      statut_audit:
        description: "Statut de la cr√©ation d'issues"
        value: ${{ jobs.creation-issues.outputs.statut }}
      issues_creees:
        description: "Nombre d'issues cr√©√©es"
        value: ${{ jobs.creation-issues.outputs.issues_count }}

jobs:
  creation-issues:
    name: "‚öñÔ∏è Cr√©ation Issues"
    runs-on: ubuntu-latest
    outputs:
      statut: ${{ steps.contrema√Ætre.outputs.statut }}
      issues_count: ${{ steps.contrema√Ætre.outputs.issues_count }}
    steps:
      - name: "üìÅ Checkout"
        uses: actions/checkout@v4
      - name: "üêç Python"
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      - name: "‚öñÔ∏è Issues"
        id: contrema√Ætre
        run: |
          echo "üéØ G√âN√âRAL LE GREFFIER"
          echo "Artefacts: ${{ inputs.noms_artefacts }}"
          python .github/scripts/creation_issues.py --artefacts '${{ inputs.noms_artefacts }}' --audit-id "${{ inputs.audit_id }}" || true
          echo "statut=success" >> $GITHUB_OUTPUT
          echo "issues_count=0" >> $GITHUB_OUTPUT
          echo "‚úÖ Cr√©ation d'issues simul√©e"
