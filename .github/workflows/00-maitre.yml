# ==============================================================================
# NIVEAU 0 : WORKFLOW MA√éTRE (DIVIN)
# ==============================================================================
# R√¥le : Permet au cr√©ateur de contourner manuellement les lois constitutionnelles
#        pour une Pull Request sp√©cifique.
# D√©clencheur : Uniquement manuel (workflow_dispatch).
# ==============================================================================

name: "üëë Ma√Ætre Contr√¥le (Divin)"

on:
  workflow_dispatch:
    inputs:
      pull_request_number:
        description: "Num√©ro de la Pull Request √† approuver"
        required: true
        type: string
      raison:
        description: "Raison de l'utilisation du droit de v√©to"
        required: true
        type: string
      loi_a_ignorer:
        description: "Quelle loi constitutionnelle ignorer ?"
        required: true
        type: choice
        options:
          - Toutes
          - Lignes
          - S√©curit√©
          - Documentation
        default: 'Toutes'

jobs:
  veto-manuel:
    name: "Veto Manuel du Ma√Ætre"
    runs-on: ubuntu-latest

    # Permissions n√©cessaires pour interagir avec la Pull Request
    permissions:
      pull-requests: write
      contents: read

    steps:
      - name: "Affichage des param√®tres du veto"
        run: |
          echo "Application du droit de v√©to sur la PR #${{ github.event.inputs.pull_request_number }}"
          echo "Raison : ${{ github.event.inputs.raison }}"
          echo "Loi(s) ignor√©e(s) : ${{ github.event.inputs.loi_a_ignorer }}"

      - name: "Approbation forc√©e de la Pull Request"
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          PR_NUMBER: ${{ github.event.inputs.pull_request_number }}
          RAISON: ${{ github.event.inputs.raison }}
          LOI: ${{ github.event.inputs.loi_a_ignorer }}
        run: |
          gh pr review $PR_NUMBER \
            --approve \
            --body "‚úÖ **VETO APPLIQU√â PAR LE MA√éTRE**

          **Raison :** $RAISON
          **Loi(s) ignor√©e(s) :** $LOI"
