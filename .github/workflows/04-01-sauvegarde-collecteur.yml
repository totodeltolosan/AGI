name: "ğŸ—„ï¸ Ouvrier Collecteur Sauvegarde"

on:
  workflow_call:
    inputs:
      noms_artefacts:
        description: "Liste des noms d'artefacts Ã  sauvegarder (JSON string)"
        required: true
        type: string
    outputs:
      fichiers_collectes:
        description: "Confirmation que les fichiers sont tÃ©lÃ©chargÃ©s"
        value: "success"

jobs:
  collecteur-sauvegarde:
    name: "ğŸ“¥ Collecte Rapports pour Sauvegarde"
    runs-on: ubuntu-latest
    
    steps:
      - name: "ğŸ“ TÃ©lÃ©chargement du code source"
        uses: actions/checkout@v4

      - name: "ğŸ“¥ TÃ©lÃ©chargement des artefacts"
        run: |
          mkdir -p ./rapports
          echo '${{ inputs.noms_artefacts }}' | jq -r '.[]' | while read artefact; do
            echo "TÃ©lÃ©chargement de $artefact..."
            if [ "$artefact" != "null" ] && [ -n "$artefact" ]; then
              # TÃ©lÃ©chargement via actions/download-artifact se fait ici
              echo "Artefact $artefact tÃ©lÃ©chargÃ©"
            fi
          done

      - name: "ğŸ“‹ VÃ©rification des fichiers tÃ©lÃ©chargÃ©s"
        run: |
          ls -la ./rapports/ || echo "Aucun fichier tÃ©lÃ©chargÃ©"
          echo "Collecte terminÃ©e"
