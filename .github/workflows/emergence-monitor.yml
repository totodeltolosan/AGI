name: ðŸŒ¸ Emergence Systems Monitor

on:
  push:
    paths: ['eve/simulation/emergence/**']
  schedule:
    - cron: '0 */4 * * *'  # Toutes les 4h

jobs:
  emergence-monitoring:
    name: Monitor Emergence Patterns
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Emergence Pattern Analysis
      run: |
        echo "ðŸŒ¸ ANALYSE PATTERNS Ã‰MERGENCE" > emergence-report.md
        echo "=============================" >> emergence-report.md
        echo "" >> emergence-report.md
        
        # Analyser fichiers Ã©mergence
        if [ -d "eve/simulation/emergence" ]; then
          emergence_files=$(find eve/simulation/emergence/ -name "*.py" | wc -l)
          echo "## ðŸ“Š SystÃ¨mes Ã‰mergence" >> emergence-report.md
          echo "- **Modules**: $emergence_files" >> emergence-report.md
          
          # Chercher patterns d'Ã©mergence dans le code
          emergence_patterns=("emergence" "emergent" "self_organiz" "complex" "adapt")
          
          echo "" >> emergence-report.md
          echo "## ðŸ” Patterns DÃ©tectÃ©s" >> emergence-report.md
          
          for pattern in "${emergence_patterns[@]}"; do
            count=$(find eve/simulation/emergence/ -name "*.py" -exec grep -c "$pattern" {} \; 2>/dev/null | paste -sd+ | bc 2>/dev/null || echo "0")
            echo "- **$pattern**: $count occurrences" >> emergence-report.md
          done
          
        else
          echo "âš ï¸ **Module Ã©mergence**: En cours de crÃ©ation" >> emergence-report.md
        fi
        
    - name: Complexity Metrics
      run: |
        echo "" >> emergence-report.md
        echo "## ðŸ“ˆ MÃ©triques ComplexitÃ©" >> emergence-report.md
        
        # Calculer mÃ©triques de complexitÃ© systÃ¨me
        python -c "
        import os
        import numpy as np
        
        try:
            # MÃ©triques basiques de complexitÃ©
            total_files = 0
            total_lines = 0
            total_functions = 0
            
            for root, dirs, files in os.walk('eve/simulation/'):
                for file in files:
                    if file.endswith('.py'):
                        total_files += 1
                        filepath = os.path.join(root, file)
                        try:
                            with open(filepath, 'r', encoding='utf-8') as f:
                                lines = f.readlines()
                                total_lines += len(lines)
                                total_functions += sum(1 for line in lines if 'def ' in line)
                        except:
                            pass
            
            # MÃ©triques de complexitÃ©
            if total_files > 0:
                avg_lines_per_file = total_lines / total_files
                avg_functions_per_file = total_functions / total_files
                
                print(f'- **Fichiers totaux**: {total_files}')
                print(f'- **Lignes totales**: {total_lines}')
                print(f'- **Fonctions totales**: {total_functions}')
                print(f'- **Moy lignes/fichier**: {avg_lines_per_file:.1f}')
                print(f'- **Moy fonctions/fichier**: {avg_functions_per_file:.1f}')
                
                # Indice de complexitÃ© Ã©mergente
                complexity_index = (total_files * avg_functions_per_file) / 1000
                print(f'- **Indice complexitÃ©**: {complexity_index:.3f}')
                
                if complexity_index > 1.0:
                    print('- **Statut**: ðŸŒŸ ComplexitÃ© Ã©mergente dÃ©tectÃ©e')
                else:
                    print('- **Statut**: ðŸŒ± SystÃ¨me en dÃ©veloppement')
            else:
                print('- **Statut**: âš ï¸ Aucun fichier dÃ©tectÃ©')
                
        except Exception as e:
            print(f'- **Erreur**: {e}')
        " >> emergence-report.md
        
    - name: Self-Organization Test
      run: |
        echo "" >> emergence-report.md
        echo "## ðŸ”„ Test Auto-Organisation" >> emergence-report.md
        
        python -c "
        import numpy as np
        import matplotlib
        matplotlib.use('Agg')  # Backend non-interactif
        import matplotlib.pyplot as plt
        
        print('ðŸ”„ Simulation auto-organisation...')
        
        # ModÃ¨le simple d'auto-organisation (automate cellulaire)
        size = 50
        grid = np.random.choice([0, 1], size=(size, size))
        
        def apply_rules(grid):
            new_grid = grid.copy()
            for i in range(1, size-1):
                for j in range(1, size-1):
                    neighbors = np.sum(grid[i-1:i+2, j-1:j+2]) - grid[i, j]
                    if grid[i, j] == 1:
                        if neighbors < 2 or neighbors > 3:
                            new_grid[i, j] = 0
                    else:
                        if neighbors == 3:
                            new_grid[i, j] = 1
            return new_grid
        
        # Ã‰volution sur 100 Ã©tapes
        complexity_scores = []
        for step in range(100):
            grid = apply_rules(grid)
            # Mesure de complexitÃ©: entropie locale
            complexity = -np.sum(grid * np.log(grid + 1e-10) + (1-grid) * np.log(1-grid + 1e-10))
            complexity_scores.append(complexity)
        
        # Analyse Ã©mergence
        initial_complexity = complexity_scores[0]
        final_complexity = complexity_scores[-1]
        max_complexity = max(complexity_scores)
        
        print(f'- **ComplexitÃ© initiale**: {initial_complexity:.2f}')
        print(f'- **ComplexitÃ© finale**: {final_complexity:.2f}')
        print(f'- **ComplexitÃ© maximale**: {max_complexity:.2f}')
        
        if max_complexity > initial_complexity * 1.5:
            print('- **RÃ©sultat**: âœ… Auto-organisation dÃ©tectÃ©e')
        else:
            print('- **RÃ©sultat**: âš ï¸ Auto-organisation limitÃ©e')
        
        # Sauvegarder graphique
        plt.figure(figsize=(10, 6))
        plt.plot(complexity_scores)
        plt.title('Ã‰volution de la ComplexitÃ© (Auto-organisation)')
        plt.xlabel('Ã‰tapes')
        plt.ylabel('ComplexitÃ©')
        plt.grid(True)
        plt.savefig('emergence_complexity.png', dpi=150, bbox_inches='tight')
        plt.close()
        
        print('- **Graphique**: emergence_complexity.png gÃ©nÃ©rÃ©')
        " >> emergence-report.md
        
    - name: Upload Emergence Reports
      uses: actions/upload-artifact@v4
      with:
        name: emergence-monitoring-report
        path: |
          emergence-report.md
          emergence_complexity.png
