name: Project Monitoring

on:
  schedule:
    - cron: '0 */6 * * *'  # Toutes les 6 heures
  workflow_dispatch:

jobs:
  monitoring:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
      with:
        fetch-depth: 0
        
    - name: Health Check
      run: |
        echo "ðŸ¥ HEALTH CHECK AGI-EVE" > health-report.md
        echo "=========================" >> health-report.md
        echo "" >> health-report.md
        
        # Check structure
        echo "## ðŸ“ Structure Projet" >> health-report.md
        if [ -d "core" ]; then
          echo "âœ… Dossier core prÃ©sent" >> health-report.md
        else
          echo "âŒ Dossier core manquant" >> health-report.md
        fi
        
        if [ -d "eve" ]; then
          echo "âœ… Dossier eve prÃ©sent" >> health-report.md
        else
          echo "âŒ Dossier eve manquant" >> health-report.md
        fi
        
        # Check dependencies
        echo "" >> health-report.md
        echo "## ðŸ“¦ DÃ©pendances" >> health-report.md
        if [ -f "requirements.txt" ]; then
          echo "âœ… requirements.txt prÃ©sent" >> health-report.md
          echo "ðŸ“Š Nombre de dÃ©pendances: $(wc -l < requirements.txt)" >> health-report.md
        else
          echo "âš ï¸ requirements.txt manquant" >> health-report.md
        fi
        
        # Check conformity
        echo "" >> health-report.md
        echo "## ðŸ“‹ ConformitÃ©" >> health-report.md
        if ls conformite_*.csv >/dev/null 2>&1; then
          latest_conformity=$(ls -t conformite_*.csv | head -1)
          violations=$(grep -c VIOLATION "$latest_conformity" || echo "0")
          total=$(wc -l < "$latest_conformity")
          echo "ðŸ“„ Dernier rapport: $latest_conformity" >> health-report.md
          echo "ðŸ”´ Violations: $violations" >> health-report.md
          echo "ðŸ“Š Total fichiers: $total" >> health-report.md
        else
          echo "âš ï¸ Aucun rapport de conformitÃ© trouvÃ©" >> health-report.md
        fi
        
    - name: Upload health report
      uses: actions/upload-artifact@v3
      with:
        name: health-report
        path: health-report.md
